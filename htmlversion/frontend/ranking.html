<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ’è¡Œæ¦œ - CS2 å†…æˆ˜åŒ¹é…ç³»ç»Ÿ</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="header">
    <div class="header-content">
      <a href="lobby.html" class="logo">CS2 BPç³»ç»Ÿ</a>
      <div class="user-info">
        <span class="user-name" id="userName"></span>
        <span class="user-elo" id="userElo"></span>
        <button class="btn btn-secondary" onclick="navigate('lobby.html')">è¿”å›å¤§å…</button>
      </div>
    </div>
  </div>
  
  <div class="container">
    <div class="card">
      <h2 class="card-title">æ’è¡Œæ¦œ TOP 50</h2>
      
      <table class="ranking-table">
        <thead>
          <tr>
            <th>æ’å</th>
            <th>ç©å®¶</th>
            <th>ELO</th>
            <th>åœºæ¬¡</th>
            <th>èƒœåœº</th>
            <th>è´¥åœº</th>
            <th>èƒœç‡</th>
            <th>K/D</th>
          </tr>
        </thead>
        <tbody id="rankingBody">
          <tr>
            <td colspan="8" style="text-align: center; color: var(--gray-500);">
              åŠ è½½ä¸­...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <script src="js/localStorage-db.js"></script>
  <script src="js/api.js"></script>
  <script src="js/utils.js"></script>
  <script>
    if (!checkLogin()) throw new Error('æœªç™»å½•');
    
    const user = User.get();
    document.getElementById('userName').textContent = user.nickname;
    document.getElementById('userElo').textContent = `ELO: ${user.elo || 1000}`;
    
    // åˆå§‹åŒ–
    async function init() {
      showLoading('åŠ è½½ä¸­...');
      
      const result = await API.history.getRanking();
      
      hideLoading();
      
      if (result.code === 0) {
        displayRanking(result.data);
      } else {
        showToast('è·å–æ’è¡Œæ¦œå¤±è´¥', 'error');
      }
    }
    
    // æ˜¾ç¤ºæ’è¡Œæ¦œ
    function displayRanking(ranking) {
      const rankingBody = document.getElementById('rankingBody');
      
      if (ranking.length === 0) {
        rankingBody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; color: var(--gray-500);">
              æš‚æ— æ•°æ®
            </td>
          </tr>
        `;
        return;
      }
      
      rankingBody.innerHTML = ranking.map(player => {
        let rankClass = '';
        let rankDisplay = player.rank;
        
        if (player.rank === 1) {
          rankClass = 'rank-1';
          rankDisplay = 'ğŸ¥‡';
        } else if (player.rank === 2) {
          rankClass = 'rank-2';
          rankDisplay = 'ğŸ¥ˆ';
        } else if (player.rank === 3) {
          rankClass = 'rank-3';
          rankDisplay = 'ğŸ¥‰';
        }
        
        // é«˜äº®å½“å‰ç”¨æˆ·
        const isCurrentUser = player.player_id === user.player_id;
        const rowStyle = isCurrentUser ? 'background: rgba(102, 126, 234, 0.1);' : '';
        
        return `
          <tr style="${rowStyle}">
            <td class="${rankClass}">${rankDisplay}</td>
            <td>
              <strong>${player.nickname}</strong>
              ${isCurrentUser ? '<span style="color: var(--primary-color); margin-left: 8px;">(æˆ‘)</span>' : ''}
            </td>
            <td><strong>${player.elo}</strong></td>
            <td>${player.total_matches}</td>
            <td style="color: var(--success-color);">${player.wins}</td>
            <td style="color: var(--danger-color);">${player.losses}</td>
            <td>${player.win_rate}%</td>
            <td>${player.kd_ratio}</td>
          </tr>
        `;
      }).join('');
    }
    
    // åˆå§‹åŒ–
    init();
  </script>
</body>
</html>

