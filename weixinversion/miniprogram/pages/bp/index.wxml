<!--BP 地图页面-->
<view class="container">
  <view class="header">
    <text class="title">地图 Ban/Pick</text>
    <view class="player-team">
      <text class="my-team">您在 {{myTeam}} 队</text>
    </view>
    <view class="current-action" wx:if="{{nextAction}}">
      <text class="action-team">{{nextAction.team}} 队</text>
      <text class="action-type">{{nextAction.action === 'ban' ? 'Ban 地图' : 'Pick 地图'}}</text>
      <text class="vote-status" wx:if="{{canVote && voteProgress}}">投票: {{voteProgress}}</text>
    </view>
    <!-- 调试信息 -->
    <view class="debug-info">
      <text class="debug-text">{{debugInfo}}</text>
      <text class="debug-time">{{lastUpdateTime}}</text>
    </view>
  </view>

  <!-- 队伍信息 -->
  <view class="teams" wx:if="{{room}}">
    <view class="team team-a">
      <text class="team-name">A 队</text>
      <view class="team-players">
        <text 
          class="player" 
          wx:for="{{teamAPlayers}}" 
          wx:key="player_id"
        >
          {{item.nickname}}
        </text>
      </view>
    </view>
    
    <text class="vs">VS</text>
    
    <view class="team team-b">
      <text class="team-name">B 队</text>
      <view class="team-players">
        <text 
          class="player" 
          wx:for="{{teamBPlayers}}" 
          wx:key="player_id"
        >
          {{item.nickname}}
        </text>
      </view>
    </view>
  </view>

  <!-- BP 历史 -->
  <view class="bp-history" wx:if="{{bpHistory.length > 0}}">
    <text class="history-title">BP 记录</text>
    <view class="history-list">
      <view 
        class="history-item {{record.action === 'ban' ? 'ban' : 'pick'}}" 
        wx:for="{{bpHistory}}" 
        wx:key="index"
        wx:for-item="record"
      >
        <text class="history-team">{{record.team}} 队</text>
        <text class="history-action">{{record.action === 'ban' ? 'Ban' : 'Pick'}}</text>
        <text class="history-map">{{record.map}}</text>
        <text class="history-votes" wx:if="{{record.votes && record.votes[record.map]}}">
          ({{record.votes[record.map]}}票)
        </text>
      </view>
    </view>
  </view>

  <!-- 地图选择 -->
  <view class="maps">
    <view 
      class="map-item {{availableMaps.includes(item) ? '' : 'disabled'}} {{canVote ? '' : 'not-my-turn'}}" 
      wx:for="{{['inferno', 'mirage', 'dust2', 'nuke', 'overpass', 'ancient', 'anubis']}}" 
      wx:key="index"
      data-map="{{item}}"
      bindtap="onBPMap"
    >
      <view class="map-placeholder">
        <text class="map-name-large">{{item}}</text>
      </view>
      <text class="map-name">{{item}}</text>
      <view class="map-overlay" wx:if="{{!availableMaps.includes(item)}}">
        <text class="overlay-text">已选择</text>
      </view>
    </view>
  </view>

  <view class="tips" wx:if="{{nextAction}}">
    <text wx:if="{{canVote}}">请队内投票选择地图（需要{{myTeam}}队半数以上同意）</text>
    <text wx:else>{{nextAction.desc}} - 等待对方队伍操作</text>
  </view>
</view>

