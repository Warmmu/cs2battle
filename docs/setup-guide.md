# CS2 内战匹配系统 - 快速配置指南

## 📦 第一次使用须知

### 1. 地图图片

BP 页面需要地图图片。请在 `miniprogram/images/` 目录下创建 `maps` 文件夹，并添加以下地图图片：

```
miniprogram/images/maps/
├── inferno.jpg
├── mirage.jpg
├── dust2.jpg
├── nuke.jpg
├── overpass.jpg
├── ancient.jpg
└── anubis.jpg
```

**图片规格建议**：
- 尺寸：600x400 像素
- 格式：JPG 或 PNG
- 文件大小：每张 < 200KB

如果暂时没有图片，可以使用纯色占位图或从网上下载 CS2 官方地图预览图。

### 2. 云开发环境配置

#### 在微信开发者工具中：

1. 点击顶部"云开发"按钮
2. 开通云开发（如果未开通）
3. 创建环境（建议创建两个环境：开发环境和生产环境）
4. 记录环境 ID

#### 初始化云环境：

在 `miniprogram/app.js` 中，确保云开发已初始化：

```javascript
wx.cloud.init({
  env: 'your-env-id', // 你的环境 ID
  traceUser: true
})
```

### 3. 数据库集合创建

登录云开发控制台 → 数据库 → 创建集合：

#### 快速创建脚本

在云开发控制台的"数据库"标签页中，依次创建以下集合（直接点击"+"号）：

| 集合名称 | 说明 |
|---------|------|
| `players` | 玩家信息表 |
| `rooms` | 房间信息表 |
| `bp_records` | BP 记录表 |
| `matches` | 比赛记录表 |
| `player_stats` | 玩家比赛数据表 |
| `elo_history` | ELO 历史记录表 |

**权限设置**：
- 所有集合：所有用户可读
- 写权限：仅创建者可写（推荐）

### 4. 云函数部署

#### 必须部署的云函数：

1. **register** - 玩家注册
2. **room** - 房间管理
3. **match** - 匹配算法
4. **bp** - 地图 Ban/Pick
5. **submit** - 提交比赛结果
6. **history** - 历史记录和排行榜

#### 部署步骤：

对每个云函数：
1. 右键云函数文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

### 5. 测试流程

#### 测试账号注册

1. 启动小程序
2. 应该会自动跳转到注册页面
3. 输入昵称（如：TestPlayer1）
4. 点击"注册并开始"
5. 成功后应跳转到大厅

#### 测试完整流程

**需要至少 4 个测试账号**：

1. 使用 4 个不同微信账号分别注册
2. 在大厅点击"加入房间"
3. 所有人点击"准备"
4. 系统自动匹配分队
5. 进入 BP 页面
6. 按流程 Ban/Pick 地图
7. 进入比赛结果录入页面
8. 填写比分和玩家数据
9. 提交后查看 ELO 变化
10. 在排行榜查看排名

### 6. 常见初始化问题

#### 问题 1：云函数调用失败

**现象**：控制台显示 "cloud.callFunction:fail"

**解决**：
- 检查云函数是否部署成功
- 确认环境 ID 配置正确
- 查看云函数日志

#### 问题 2：数据库写入失败

**现象**：注册成功但没有数据

**解决**：
- 检查数据库集合是否创建
- 检查权限设置
- 查看云函数日志

#### 问题 3：地图图片不显示

**现象**：BP 页面地图显示灰色

**解决**：
- 确认 `miniprogram/images/maps/` 目录存在
- 确认图片文件名正确（小写）
- 检查图片路径是否正确

### 7. 开发模式 vs 生产模式

#### 开发模式

- 使用开发环境
- 可以频繁测试
- 数据可以随时清空

#### 生产模式

- 使用生产环境
- 定期备份数据
- 监控性能和错误

### 8. 性能优化建议

#### 初期（< 100 用户）
- 基础配置即可
- 无需特殊优化

#### 中期（100-1000 用户）
- 添加数据库索引
- 优化查询语句
- 启用云函数并发

#### 后期（> 1000 用户）
- 考虑数据分片
- 使用 CDN 加速
- 增加缓存层

## 🎯 初始化检查清单

部署完成后，请确认以下项目：

- [ ] 云开发环境已创建
- [ ] 6 个数据库集合已创建
- [ ] 6 个云函数已部署
- [ ] 地图图片已准备
- [ ] 可以正常注册
- [ ] 可以创建房间
- [ ] 可以完成匹配
- [ ] 可以进行 BP
- [ ] 可以提交结果
- [ ] ELO 正确计算
- [ ] 排行榜正常显示

## 📞 获取帮助

如果遇到问题：

1. 查看云函数日志
2. 查看控制台错误信息
3. 参考 `docs/api.md` 文档
4. 提交 Issue

---

配置完成后，就可以开始使用了！🎉

